Há»‡ thá»‘ng Account / Authentication cho Backend Django vá»›i JWT vÃ  REST Framework
âœ… 1. ÄÄƒng kÃ½ tÃ i khoáº£n ngÆ°á»i dÃ¹ng
Endpoint:
POST /api/v1/accounts/users/

Request body:
{
  "username": "example",
  "email": "user@gmail.com",
  "password": "securepassword123",
  "first_name": "Nguyá»…n",
  "last_name": "VÄƒn A",
  "bio": "MÃ´ táº£ cÃ¡ nhÃ¢n"
}

YÃªu cáº§u:
Email pháº£i lÃ  Ä‘á»‹a chá»‰ Gmail (@gmail.com)
Máº­t kháº©u pháº£i cÃ³ Ã­t nháº¥t 8 kÃ½ tá»±
Response:

{
  "id": 1,
  "username": "example",
  "email": "user@gmail.com",
  "first_name": "Nguyá»…n",
  "last_name": "VÄƒn A",
  "avatar": null,
  "bio": "MÃ´ táº£ cÃ¡ nhÃ¢n",
  "is_admin": false
}

Lá»—i:
400 Bad Request: Náº¿u username/email Ä‘Ã£ tá»“n táº¡i hoáº·c dá»¯ liá»‡u khÃ´ng há»£p lá»‡
ğŸ” 2. ÄÄƒng nháº­p (Login)
Endpoint:
POST /api/v1/auth/token/

Request body:
{
  "username": "user@gmail.com",
  "password": "securepassword123"
}
LÆ°u Ã½: Há»‡ thá»‘ng sá»­ dá»¥ng email lÃ m tÃªn Ä‘Äƒng nháº­p (USERNAME_FIELD = 'email')
Response:
{
  "access": "<JWT_ACCESS_TOKEN>",
  "refresh": "<JWT_REFRESH_TOKEN>",
  "user": {
    "id": 1,
    "username": "example",
    "email": "user@gmail.com",
    "first_name": "Nguyá»…n",
    "last_name": "VÄƒn A",
    "avatar": null,
    "bio": "MÃ´ táº£ cÃ¡ nhÃ¢n",
    "is_admin": false
  }
}
Lá»—i:
401 Unauthorized: Náº¿u thÃ´ng tin Ä‘Äƒng nháº­p khÃ´ng chÃ­nh xÃ¡c
HÆ°á»›ng dáº«n frontend:
LÆ°u access token vÃ  refresh token vÃ o localStorage hoáº·c httpOnly cookie
LÆ°u thÃ´ng tin user Ä‘á»ƒ hiá»ƒn thá»‹ trÃªn giao diá»‡n
Sá»­ dá»¥ng access token Ä‘á»ƒ gá»i cÃ¡c API yÃªu cáº§u xÃ¡c thá»±c
Refresh token khi access token háº¿t háº¡n
3. LÃ m má»›i access token
POST /api/v1/auth/token/refresh/
Request body:
{
  "refresh": "<JWT_REFRESH_TOKEN>"
}
Response:
{
  "access": "<NEW_JWT_ACCESS_TOKEN>"
}
Lá»—i:
401 Unauthorized: Náº¿u refresh token khÃ´ng há»£p lá»‡ hoáº·c Ä‘Ã£ háº¿t háº¡n
HÆ°á»›ng dáº«n frontend:
Khi nháº­n lá»—i 401 tá»« API, gá»i endpoint refresh token
Náº¿u refresh thÃ nh cÃ´ng, cáº­p nháº­t access token má»›i vÃ  thá»­ láº¡i request ban Ä‘áº§u
Náº¿u refresh tháº¥t báº¡i, chuyá»ƒn hÆ°á»›ng ngÆ°á»i dÃ¹ng vá» trang Ä‘Äƒng nháº­p
â“ 4. QuÃªn máº­t kháº©u
BÆ°á»›c 1 - Gá»­i email reset:
Endpoint:
POST /api/v1/accounts/password/reset/
{
  "email": "user@gmail.com"
}
{
  "message": "MÃ£ xÃ¡c nháº­n Ä‘Ã£ Ä‘Æ°á»£c gá»­i Ä‘áº¿n email cá»§a báº¡n."
}
LÆ°u Ã½: Há»‡ thá»‘ng gá»­i mÃ£ OTP 6 chá»¯ sá»‘ qua email, cÃ³ hiá»‡u lá»±c trong 15 phÃºt
BÆ°á»›c 2 - XÃ¡c nháº­n vÃ  Ä‘áº·t láº¡i máº­t kháº©u:
POST /api/v1/accounts/password/reset/confirm/
Request body:
{
  "email": "user@gmail.com",
  "token": "123456",
  "new_password": "newSecurePassword123"
}
Response:
{
  "message": "Äáº·t láº¡i máº­t kháº©u thÃ nh cÃ´ng. Vui lÃ²ng Ä‘Äƒng nháº­p vá»›i máº­t kháº©u má»›i."
}
Lá»—i:
400 Bad Request: Náº¿u mÃ£ OTP khÃ´ng há»£p lá»‡ hoáº·c Ä‘Ã£ háº¿t háº¡n
404 Not Found: Náº¿u email khÃ´ng tá»“n táº¡i
HÆ°á»›ng dáº«n frontend:
Hiá»ƒn thá»‹ form nháº­p email Ä‘á»ƒ gá»­i mÃ£ OTP
Sau khi gá»­i email, hiá»ƒn thá»‹ form nháº­p mÃ£ OTP vÃ  máº­t kháº©u má»›i
Hiá»ƒn thá»‹ Ä‘á»“ng há»“ Ä‘áº¿m ngÆ°á»£c 15 phÃºt cho thá»i háº¡n mÃ£ OTP
Sau khi Ä‘áº·t láº¡i thÃ nh cÃ´ng, chuyá»ƒn hÆ°á»›ng ngÆ°á»i dÃ¹ng Ä‘áº¿n trang Ä‘Äƒng nháº­p
5. ThÃ´ng tin ngÆ°á»i dÃ¹ng hiá»‡n táº¡i
Endpoint:
GET /api/v1/accounts/users/me/
Headers:
Authorization: Bearer <JWT_ACCESS_TOKEN>
Response:
{
  "id": 1,
  "username": "example",
  "email": "user@gmail.com",
  "first_name": "Nguyá»…n",
  "last_name": "VÄƒn A",
  "avatar": null,
  "bio": "MÃ´ táº£ cÃ¡ nhÃ¢n",
  "is_admin": false
}
HÆ°á»›ng dáº«n frontend:
Gá»i API nÃ y sau khi Ä‘Äƒng nháº­p Ä‘á»ƒ láº¥y thÃ´ng tin ngÆ°á»i dÃ¹ng
LÆ°u thÃ´ng tin vÃ o state/context Ä‘á»ƒ sá»­ dá»¥ng trong á»©ng dá»¥ng
Kiá»ƒm tra trÆ°á»ng is_admin Ä‘á»ƒ xÃ¡c Ä‘á»‹nh quyá»n truy cáº­p
6. ÄÄƒng xuáº¥t
POST /api/v1/auth/logout/
Headers:
Authorization: Bearer <JWT_ACCESS_TOKEN>
Request body:
{
  "refresh": "<JWT_REFRESH_TOKEN>"
}
Response:
{
  "status": "logout successful"
}
HÆ°á»›ng dáº«n frontend:
Gá»i API nÃ y khi ngÆ°á»i dÃ¹ng muá»‘n Ä‘Äƒng xuáº¥t
XÃ³a token vÃ  thÃ´ng tin ngÆ°á»i dÃ¹ng khá»i localStorage/cookie
Chuyá»ƒn hÆ°á»›ng ngÆ°á»i dÃ¹ng vá» trang Ä‘Äƒng nháº­p
7. PhÃ¢n quyá»n
Há»‡ thá»‘ng phÃ¢n quyá»n Ä‘Æ¡n giáº£n:
is_admin: XÃ¡c Ä‘á»‹nh ngÆ°á»i dÃ¹ng cÃ³ quyá»n quáº£n trá»‹ hay khÃ´ng
is_superuser: Quyá»n cao nháº¥t (thÆ°á»ng khÃ´ng sá»­ dá»¥ng trá»±c tiáº¿p trong API)
HÆ°á»›ng dáº«n frontend:
Kiá»ƒm tra user.is_admin === true Ä‘á»ƒ hiá»ƒn thá»‹ giao diá»‡n quáº£n trá»‹
Kiá»ƒm tra quyá»n trÆ°á»›c khi hiá»ƒn thá»‹ cÃ¡c chá»©c nÄƒng quáº£n trá»‹
Xá»­ lÃ½ lá»—i 403 Forbidden khi ngÆ°á»i dÃ¹ng khÃ´ng cÃ³ quyá»n truy cáº­p
âš™ï¸ 8. Quy trÃ¬nh tÃ­ch há»£p trong frontend
ÄÄƒng kÃ½ ngÆ°á»i dÃ¹ng:
Táº¡o form Ä‘Äƒng kÃ½ vá»›i cÃ¡c trÆ°á»ng: username, email, password, first_name, last_name, bio
Validate dá»¯ liá»‡u trÆ°á»›c khi gá»­i (email pháº£i lÃ  Gmail, password â‰¥ 8 kÃ½ tá»±)
Gá»­i request POST Ä‘áº¿n /api/v1/accounts/users/
Xá»­ lÃ½ response thÃ nh cÃ´ng/lá»—i vÃ  thÃ´ng bÃ¡o cho ngÆ°á»i dÃ¹ng
ÄÄƒng nháº­p:
Táº¡o form Ä‘Äƒng nháº­p vá»›i cÃ¡c trÆ°á»ng: email, password
Gá»­i request POST Ä‘áº¿n /api/v1/auth/token/
LÆ°u token vÃ o localStorage/cookie vÃ  thÃ´ng tin user vÃ o state/context
Äiá»u hÆ°á»›ng Ä‘áº¿n trang chÃ­nh
Quáº£n lÃ½ token:
Táº¡o interceptor cho cÃ¡c HTTP request Ä‘á»ƒ tá»± Ä‘á»™ng thÃªm Authorization header
Táº¡o logic xá»­ lÃ½ lá»—i 401 vÃ  refresh token
Implement auto-logout khi khÃ´ng thá»ƒ refresh token
QuÃªn máº­t kháº©u:
Táº¡o form nháº­p email
Gá»­i request Ä‘áº¿n API gá»­i mÃ£ OTP
Táº¡o form nháº­p mÃ£ OTP vÃ  máº­t kháº©u má»›i
Gá»­i request xÃ¡c nháº­n vÃ  Ä‘áº·t máº­t kháº©u má»›i
ThÃ´ng bÃ¡o káº¿t quáº£ vÃ  Ä‘iá»u hÆ°á»›ng vá» trang Ä‘Äƒng nháº­p
Táº£i thÃ´ng tin ngÆ°á»i dÃ¹ng:
Gá»i API /api/v1/accounts/users/me/ sau khi Ä‘Äƒng nháº­p
LÆ°u thÃ´ng tin vÃ o state/context toÃ n cáº§u
Hiá»ƒn thá»‹ thÃ´ng tin ngÆ°á»i dÃ¹ng trÃªn giao diá»‡n
Kiá»ƒm tra quyá»n truy cáº­p:
Táº¡o hÃ m tiá»‡n Ã­ch kiá»ƒm tra quyá»n (isAdmin, hasAccess)
Sá»­ dá»¥ng trong cÃ¡c báº£o vá»‡ route vÃ  Ä‘iá»u kiá»‡n hiá»ƒn thá»‹ UI
Hiá»ƒn thá»‹ thÃ´ng bÃ¡o phÃ¹ há»£p khi khÃ´ng cÃ³ quyá»n
Báº£o máº­t:
KhÃ´ng lÆ°u máº­t kháº©u dÆ°á»›i báº¥t ká»³ hÃ¬nh thá»©c nÃ o
LÆ°u token trong httpOnly cookie náº¿u cÃ³ thá»ƒ (trÃ¡nh XSS)
Tá»± Ä‘á»™ng lÃ m má»›i token khi gáº§n háº¿t háº¡n
9. Header API Authentication
Táº¥t cáº£ API yÃªu cáº§u xÃ¡c thá»±c Ä‘á»u cáº§n gá»­i header:
Authorization: Bearer <JWT_ACCESS_TOKEN>
Tuá»•i thá» token:
Access token: 60 phÃºt
Refresh token: 1 ngÃ y
